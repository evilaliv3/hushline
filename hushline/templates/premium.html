{% extends "base.html" %}
{% block title %}Premium{% endblock %}
{% block content %}
  <h2>Choose a Hush Line Plan</h2>

  <div id="plan-wrapper">
    <div class="plan">
      {% if user.tier_id == 1 or user.tier_id == None %}
        <p class="plan-status badge">üìç Current Plan</p>
      {% endif %}
      {% if user.tier_id == 2 %}
        <p class="plan-status">Fewer Features</p>
      {% endif %}
      <h3>Core/Free</h3>
      <div class="feature-meta">
        <p>Monthly Messages</p>
        <p>Unlimited</p>
      </div>
      <div class="feature-meta">
        <p>Forwarding Addresses</p>
        <p>1</p>
      </div>
      <div class="feature-meta">
        <p>Tor Onion Service</p>
        <p>‚úÖ</p>
      </div>
      <div class="feature-meta">
        <p>End-to-End Encryption</p>
        <p>‚úÖ</p>
      </div>
      <div class="feature-meta">
        <p>Easy Message Forwarding</p>
        <p>‚úÖ</p>
      </div>
      <div class="feature-meta">
        <p>OCR Vision Assistant</p>
        <p>‚úÖ</p>
      </div>
    </div>
    <div class="plan plan-recommended">
      {% if user.tier_id == 1 or user.tier_id == None %}
        <p class="plan-status badge">‚≠êÔ∏è Recommended</p>
      {% endif %}
      {% if user.tier_id == 2 %}
        <p class="plan-status">Current Plan</p>
      {% endif %}
      <h3>Super User</h3>
      <div class="feature-meta">
        <p>All Free Features</p>
      </div>
      <div class="feature-meta">
        <p>Monthly Messages</p>
        <p>Unlimited</p>
      </div>
      <div class="feature-meta">
        <p>Aliases</p>
        <p>100</p>
      </div>
      <div class="feature-meta">
        <p>Forwarding Addresses</p>
        <p>100</p>
      </div>
      <div class="feature-meta">
        <p>Custom Message Subjects</p>
        <p>100</p>
      </div>
      <div class="feature-meta">
        <p>Self-Destructing Messages</p>
        <p>‚úÖ</p>
      </div>
      <div class="feature-meta">
        <p>Monthly Price</p>
        <p>$26</p>
      </div>
      {% if user.tier_id == 1 or user.tier_id == None %}
        <form
          id="upgrade-form"
          action="{{ url_for('premium.upgrade') }}"
          method="post"
        >
          <button id="upgrade">Upgrade Now</button>
        </form>
      {% endif %}
      {% if user.tier_id == 2 %}
        {% if user.stripe_subscription_cancel_at_period_end %}
        <p>Your subscription will expire on {{ user.stripe_subscription_current_period_end.strftime('%B %d, %Y') }}.</p>
        <form
          id="enable-autorenew-form"
          action="{{ url_for('premium.disable_autorenew') }}"
          method="post"
        >
          <button id="enable-autorenew">Automatically Renew</button>
        </form>
        <form
          id="cancel-form"
          action="{{ url_for('premium.disable_autorenew') }}"
          method="post"
        >
          <button id="cancel">Cancel Now</button>
        </form>
        {% else %}
        <form
          id="disable-autorenew-form"
          action="{{ url_for('premium.disable_autorenew') }}"
          method="post"
        >
          <button id="disable-autorenew">Don't Renew</button>
        </form>
        {% endif %}
    {% endif %}
    </div>
  </div>

  <div id="invoice-wrapper">
    {% if invoices %}
      <h3>Invoices</h3>
      <table class="table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Amount Paid</th>
            <th>Status</th>
            <th>Receipt</th>
          </tr>
        </thead>
        <tbody>
          {% for invoice in invoices %}
            <tr>
              <td>{{ invoice.created_at.strftime('%Y-%m-%d') }}</td>
              <td>${{ invoice.total / 100 }}</td>
              <td>{{ invoice.status.value }}</td>
              <td>
                <a href="{{ invoice.hosted_invoice_url }}" target="_blank">
                  Receipt
                </a>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% endif %}
  </div>
{% endblock %}

{% block scripts %}
  <script src="{{ url_for('static', filename='js/premium.js') }}"></script>
{% endblock %}
